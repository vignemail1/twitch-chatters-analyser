{{ define "sessions.html" }}
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="utf-8" />
    <title>{{ .Title }}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="/static/css/main.css" rel="stylesheet" />
    <script src="/static/js/timezone.js"></script>
</head>
<body class="dark">
<header>
    <h1>Twitch Chatters Analyser</h1>
    <div class="user-info">
        {{ if .CurrentUser }}
            ConnectÃ© en tant que <strong>{{ .CurrentUser.DisplayName }}</strong> ({{ .CurrentUser.Login }})
            <p><a href="/">Accueil</a> | <a href="/channels">Mes chaÃ®nes</a></p>
            {{ if .HasActiveSession }}
            <p><a href="/analysis">Voir l'analyse de la session</a></p>
            {{ end }}
            <p><a href="/auth/logout" style="color: #ef4444;">Se dÃ©connecter</a></p>
        {{ else }}
            <a href="/auth/login">Se connecter avec Twitch</a>
        {{ end }}
    </div>
</header>
<main>
<h2>Mes sessions sauvegardÃ©es</h2>

{{ if .Saved }}
    <div class="info" style="background-color: #15803d; border-left-color: #22c55e; margin-bottom: 1.5rem;">
        <p><strong>âœ… Session sauvegardÃ©e avec succÃ¨s</strong></p>
        <p>Votre session d'analyse a Ã©tÃ© conservÃ©e et ne sera pas supprimÃ©e lors de la dÃ©connexion.</p>
    </div>
{{ end }}

{{ if .Deleted }}
    <div class="info" style="background-color: #dc2626; border-left-color: #ef4444; margin-bottom: 1.5rem;">
        <p><strong>ğŸ—‘ï¸ Session supprimÃ©e avec succÃ¨s</strong></p>
        <p>La session et toutes ses captures ont Ã©tÃ© dÃ©finitivement supprimÃ©es.</p>
    </div>
{{ end }}

{{ if not .Sessions }}
    <div class="info">
        <p>ğŸ“‹ Aucune session sauvegardÃ©e pour le moment.</p>
        <p>Lorsque vous consultez une analyse de session active, vous pouvez la sauvegarder pour la conserver.</p>
        <p><a href="/channels">Capturer des chatters maintenant</a></p>
    </div>
{{ else }}
    <table>
        <thead>
        <tr>
            <th>UUID</th>
            <th>Statut</th>
            <th>CrÃ©Ã©e le</th>
            <th>Mise Ã  jour</th>
            <th>Actions</th>
        </tr>
        </thead>
        <tbody>
        {{ range .Sessions }}
            <tr>
                <td><code style="background-color: #1f1f23; padding: 0.2rem 0.4rem; border-radius: 3px;">{{ .SessionUUID }}</code></td>
                <td>
                    {{ if eq .Status "saved" }}
                        <span style="color: #22c55e;">âœ”ï¸ SauvegardÃ©e</span>
                    {{ else }}
                        <span style="color: #adadb8;">{{ .Status }}</span>
                    {{ end }}
                </td>
                <td data-utc-date="{{ .CreatedAt.Format "2006-01-02T15:04:05Z07:00" }}" data-format="datetime">{{ .CreatedAt.Format "02/01/2006 15:04" }}</td>
                <td data-utc-date="{{ .UpdatedAt.Format "2006-01-02T15:04:05Z07:00" }}" data-format="datetime">{{ .UpdatedAt.Format "02/01/2006 15:04" }}</td>
                <td>
                    <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                        <a href="/analysis/saved/{{ .SessionUUID }}" style="display: inline-block; background-color: #9147ff; color: #fff; padding: 0.5rem 1rem; border-radius: 4px; text-decoration: none; font-weight: 600; white-space: nowrap;">
                            ğŸ” Consulter
                        </a>
                        <a href="/sessions/export/{{ .SessionUUID }}?format=csv" style="display: inline-block; background-color: #047857; color: #fff; padding: 0.5rem 0.75rem; border-radius: 4px; text-decoration: none; font-weight: 600; white-space: nowrap;" title="Exporter en CSV">
                            ğŸ“„ CSV
                        </a>
                        <a href="/sessions/export/{{ .SessionUUID }}?format=json" style="display: inline-block; background-color: #0369a1; color: #fff; padding: 0.5rem 0.75rem; border-radius: 4px; text-decoration: none; font-weight: 600; white-space: nowrap;" title="Exporter en JSON">
                            ğŸ“‹ JSON
                        </a>
                        <form method="post" action="/sessions/delete" style="display: inline;">
                            <input type="hidden" name="session_uuid" value="{{ .SessionUUID }}">
                            <button type="submit" style="background-color: #dc2626; border-color: #dc2626; padding: 0.5rem 0.75rem; white-space: nowrap;" onclick="return confirm('Supprimer dÃ©finitivement cette session ?')" title="Supprimer la session">ğŸ—‘ï¸</button>
                        </form>
                    </div>
                </td>
            </tr>
        {{ end }}
        </tbody>
    </table>
{{ end }}

<div style="margin-top: 2rem;">
    <h3>ğŸ’¡ Astuce</h3>
    <p style="color: #adadb8;">Les sessions sauvegardÃ©es ne seront pas supprimÃ©es lors de la dÃ©connexion. Vous pouvez les consulter Ã  tout moment pour comparer les rÃ©sultats d'analyses prÃ©cÃ©dentes.</p>
    <p style="color: #adadb8;">Les exports CSV et JSON contiennent toutes les donnÃ©es capturÃ©es : ID Twitch, login, nom d'affichage, date de crÃ©ation du compte, nombre de fois vu, premiÃ¨re et derniÃ¨re dÃ©tection.</p>
</div>
</main>
</body>
</html>
{{ end }}
