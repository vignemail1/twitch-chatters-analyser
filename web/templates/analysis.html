{{ define "analysis_page" }}
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="utf-8" />
    <title>{{ .Title }}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="/static/css/main.css" rel="stylesheet" />
</head>
<body class="dark">
<header>
    <h1>Twitch Chatters Analyser</h1>
    <div class="user-info">
        {{ if .CurrentUser }}
            Connect√© en tant que <strong>{{ .CurrentUser.DisplayName }}</strong> ({{ .CurrentUser.Login }})
            <p><a href="/channels">Voir mes cha√Ænes mod√©r√©es</a></p>
            <p><a href="/analysis">Voir l'analyse de la session</a></p>
        {{ else }}
            <a href="/auth/login">Se connecter avec Twitch</a>
        {{ end }}
    </div>
</header>
<main>
<h2>üìä Analyse de la session</h2>

{{ if .Purged }}
<div class="info" style="background-color: #15803d; border-left-color: #22c55e; margin-bottom: 1.5rem;">
    <p><strong>‚úÖ Session purg√©e avec succ√®s</strong></p>
    <p>Toutes les captures ont √©t√© supprim√©es. Vous pouvez recommencer une nouvelle analyse.</p>
</div>
{{ end }}

<div class="info" style="margin-bottom: 2rem;">
    <p><strong>Session UUID :</strong> <code style="background-color: #0e0e10; padding: 0.2rem 0.4rem; border-radius: 3px;">{{ .SessionUUID }}</code></p>
    {{ if .BroadcasterID }}
    <p><strong>Filtr√© pour :</strong> Broadcaster ID {{ .BroadcasterID }}</p>
    {{ end }}
</div>

{{ if .Summary }}
    <div style="background-color: #18181b; padding: 1.5rem; border-radius: 8px; margin-bottom: 2rem; border-left: 4px solid #9147ff;">
        <h3 style="margin-top: 0; color: #9147ff;">üìä R√©sum√© global</h3>
        <p style="font-size: 1.2rem; margin: 0.5rem 0;"><strong>{{ .Summary.TotalAccounts }}</strong> comptes distincts captur√©s</p>
        <p style="color: #adadb8; font-size: 0.9rem; margin: 0.5rem 0;">Donn√©es g√©n√©r√©es le {{ .Summary.GeneratedAt.Format "02/01/2006 √† 15:04" }}</p>
    </div>

    <h3>üìÖ Top 10 des jours de cr√©ation de comptes</h3>

    {{ if not .Summary.TopDays }}
        <div class="info">
            <p>Aucune donn√©e disponible.</p>
            <p>Les comptes captur√©s n'ont pas encore √©t√© enrichis par le worker, ou aucun compte n'a de date de cr√©ation connue.</p>
        </div>
    {{ else }}
        <table>
            <thead>
            <tr>
                <th>Date de cr√©ation</th>
                <th>Nombre de comptes</th>
                <th>% du total</th>
                <th>Indicateur</th>
            </tr>
            </thead>
            <tbody>
            {{ range .Summary.TopDays }}
                <tr>
                    <td><strong>{{ .Date }}</strong></td>
                    <td>{{ .Count }}</td>
                    <td>
                        {{ if gt $.Summary.TotalAccounts 0 }}
                            {{ div (mul .Count 100) $.Summary.TotalAccounts }}%
                        {{ else }}
                            0%
                        {{ end }}
                    </td>
                    <td>
                        {{ if ge .Count 100 }}
                            <span style="color: #ef4444; font-weight: 600;">‚ùå CRITIQUE</span>
                        {{ else if ge .Count 50 }}
                            <span style="color: #f59e0b; font-weight: 600;">‚ö†Ô∏è SUSPECT</span>
                        {{ else if ge .Count 30 }}
                            <span style="color: #3b82f6;">üîç √Ä surveiller</span>
                        {{ else }}
                            <span style="color: #10b981;">‚úÖ Normal</span>
                        {{ end }}
                    </td>
                </tr>
            {{ end }}
            </tbody>
        </table>

        <div style="margin-top: 2rem; padding: 1rem; background-color: #18181b; border-radius: 4px;">
            <h4 style="margin-top: 0; color: #efeff1;">üìñ Guide d'interpr√©tation</h4>
            <ul style="color: #adadb8; margin-left: 1.5rem; line-height: 1.8;">
                <li><span style="color: #ef4444; font-weight: 600;">‚ùå CRITIQUE (100+)</span> : Vague de bots presque certaine</li>
                <li><span style="color: #f59e0b; font-weight: 600;">‚ö†Ô∏è SUSPECT (50-99)</span> : Tr√®s probablement des bots</li>
                <li><span style="color: #3b82f6;">üîç √Ä surveiller (30-49)</span> : Potentiellement suspect selon contexte</li>
                <li><span style="color: #10b981;">‚úÖ Normal (< 30)</span> : Distribution attendue</li>
            </ul>
            <p style="color: #adadb8; margin-top: 1rem; font-size: 0.9rem;">
                <strong>Note :</strong> Ces seuils sont indicatifs. V√©rifiez toujours le contexte (raids, √©v√©nements sp√©ciaux, etc.).
            </p>
        </div>
    {{ end }}
{{ else }}
    <div class="info">
        <p><strong>Aucun r√©sum√© disponible pour cette session.</strong></p>
        <p>Assurez-vous d'avoir captur√© des chatters depuis la page <a href="/channels">/channels</a>.</p>
        <p>Le worker peut prendre quelques minutes pour enrichir les donn√©es des comptes.</p>
    </div>
{{ end }}

<div style="margin-top: 3rem; padding-top: 2rem; border-top: 1px solid #2d2d31; display: flex; gap: 1rem; flex-wrap: wrap; justify-content: center; align-items: center;">
    <a href="/channels" style="display: inline-block; background-color: #9147ff; color: #fff; padding: 0.75rem 1.5rem; border-radius: 4px; text-decoration: none; font-weight: 600;">
        ‚Üê Retour aux cha√Ænes
    </a>
    
    <form method="POST" action="/sessions/purge" style="display: inline-block;" onsubmit="return confirm('Voulez-vous vraiment supprimer TOUTES les captures de cette session ? Cette action est irr√©versible.')">
        <button type="submit" style="background-color: #991b1b; color: #fff; padding: 0.75rem 1.5rem; border-radius: 4px; border: none; font-weight: 600; cursor: pointer; font-size: 1rem;">
            üóëÔ∏è Purger la session
        </button>
    </form>
</div>
</main>
</body>
</html>
{{ end }}
