{{ define "channels.html" }}
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="utf-8" />
    <title>{{ .Title }}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="/static/css/main.css" rel="stylesheet" />
</head>
<body class="dark">
<header>
    <h1>Twitch Chatters Analyser</h1>
    <div class="user-info">
        {{ if .CurrentUser }}
            Connecté en tant que <strong>{{ .CurrentUser.DisplayName }}</strong> ({{ .CurrentUser.Login }})
            <p><a href="/channels">Voir mes chaînes modérées</a></p>
            <p><a href="/analysis">Voir l'analyse de la session</a></p>
        {{ else }}
            <a href="/auth/login">Se connecter avec Twitch</a>
        {{ end }}
    </div>
</header>
<main>
<h2>Mes chaînes modérées</h2>

{{ if .CaptureEnqueued }}
    <div class="success">
        <p>✅ Une capture a été planifiée. Elle sera traitée par le worker dans quelques instants.</p>
    </div>
{{ end }}

{{ if not .Channels }}
    <div class="info">
        <p>Aucune chaîne modérée trouvée.</p>
        <p>Vérifiez que vous êtes bien modérateur sur au moins une chaîne et que le scope <code style="background-color: #1f1f23; padding: 0.2rem 0.4rem; border-radius: 3px;">user:read:moderated_channels</code> est autorisé.</p>
    </div>
{{ else }}
    <table>
        <thead>
        <tr>
            <th>ID</th>
            <th>Login</th>
            <th>Nom</th>
            <th>Actions</th>
        </tr>
        </thead>
        <tbody>
        {{ range .Channels }}
            <tr>
                <td>{{ .BroadcasterID }}</td>
                <td><a href="https://twitch.tv/{{ .BroadcasterLogin }}" target="_blank">{{ .BroadcasterLogin }}</a></td>
                <td>{{ .BroadcasterName }}</td>
                <td>
                    <form method="post" action="/sessions/capture">
                        <input type="hidden" name="broadcaster_id" value="{{ .BroadcasterID }}">
                        <input type="hidden" name="broadcaster_login" value="{{ .BroadcasterLogin }}">
                        <button type="submit">Capturer les chatters</button>
                    </form>
                </td>
            </tr>
        {{ end }}
        </tbody>
    </table>
{{ end }}
</main>
</body>
</html>
{{ end }}
