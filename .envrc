# Configuration direnv/mise pour charger automatiquement .env
# Compatible avec mise (https://mise.jdx.dev) et fnox (https://fnox.jdx.dev)

# Activer mise
if command -v mise &> /dev/null; then
  eval "$(mise activate bash)"
  mise trust
fi

# Activer fnox (si installé)
if command -v fnox &> /dev/null; then
  eval "$(fnox activate bash)"
fi

# Charger .env si présent
if [ -f .env ]; then
  dotenv .env
else
  echo "⚠️  Fichier .env manquant. Copier .env.example vers .env et le remplir."
fi

# Vérifier que les variables critiques sont définies
if [ -f .env ]; then
  REQUIRED_VARS=(
    "TWITCH_CLIENT_ID"
    "TWITCH_CLIENT_SECRET"
    "MYSQL_ROOT_PASSWORD"
    "MYSQL_PASSWORD"
    "APP_SESSION_SECRET"
    "ACME_EMAIL"
    "TRAEFIK_AUTH"
  )
  
  MISSING_VARS=()
  for var in "${REQUIRED_VARS[@]}"; do
    if [ -z "${!var}" ]; then
      MISSING_VARS+=("$var")
    fi
  done
  
  if [ ${#MISSING_VARS[@]} -gt 0 ]; then
    echo "❌ Variables manquantes dans .env :"
    for var in "${MISSING_VARS[@]}"; do
      echo "  - $var"
    done
    echo ""
    echo "Lancer : mise run env-generate"
  fi
fi
